


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Migration Guide 2.1.x to 2.2.x &mdash; Akka Documentation</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../_static/base.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Exo:300,400,600,700" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/toc.js"></script>
    <script type="text/javascript" src="../_static/prettify.js"></script>
    <script type="text/javascript" src="../_static/highlightCode.js"></script>
    <script type="text/javascript" src="../_static/effects.core.js"></script>
    <script type="text/javascript" src="../_static/effects.highlight.js"></script>
    <script type="text/javascript" src="../_static/scrollTo.js"></script>
    <script type="text/javascript" src="../_static/contentsFix.js"></script>
    <script type="text/javascript" src="../_static/ga.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Akka Documentation" href="../index.html" />
    <link rel="up" title="Migration Guides" href="migration-guides.html" />
    <link rel="next" title="Issue Tracking" href="issue-tracking.html" />
    <link rel="prev" title="Migration Guide 2.0.x to 2.1.x" href="migration-guide-2.0.x-2.1.x.html" />
    <!--Google Analytics-->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-21117439-1']);
      _gaq.push(['_setDomainName', 'akka.io']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })()
    </script>

  </head>
  <body>
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <div class="navbar-logo">
          <a href="http://akka.io"><img src="../_static/logo-small.png" /></a>
        </div>    
        <ul class="nav">
          <li><a href="http://akka.io/docs">Documentation</a></li>
          <li><a href="http://akka.io/faq">FAQ</a></li>
          <li><a href="http://typesafe.com/stack/downloads/akka">Download</a></li>
          <li><a href="http://groups.google.com/group/akka-user">Mailing List</a></li>
          <li><a href="http://github.com/akka/akka">Code</a></li>           
          <li><a href="http://typesafe.com/products/typesafe-subscription">Commercial Support</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="main">
    <div class="container">
      <div class="page-title">Migration Guide 2.1.x to 2.2.x</div>
      <div class="pdf-link"><a href="../AkkaScala.pdf" title="Akka Scala Documentation"><img src="../_static/pdf-scala-icon.png" style="height: 40px;" /></a></div>
      <div class="pdf-link"><a href="../AkkaJava.pdf" title="Akka Java Documentation"><img src="../_static/pdf-java-icon.png" style="height: 40px;" /></a></div>
    </div>
    <div class="main-container">
      <div class="container">
        <div class="row">
          <div class="span12">
            <ul class="breadcrumb">           
              <li>
                 <span class="divider">|</span> <a href="issue-tracking.html">Issue Tracking</a> <span class="divider">»</span>
              </li>
              <li>
                <a href="../index.html">Contents</a>
              </li>
              <li>
                <span class="divider">«</span> <a href="migration-guide-2.0.x-2.1.x.html">Migration Guide 2.0.x to 2.1.x</a> <span class="divider">|</span>
              </li>
              <li>
                Version 2.2.3
              </li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div class="span9">
            <div id="cse">Loading</div>
          </div><div class="span9">
            
  <div class="section" id="migration-guide-2-1-x-to-2-2-x">
<span id="migration-2-2"></span><h1>Migration Guide 2.1.x to 2.2.x</h1>
<p>The 2.2 release contains several structural changes that require some
simple, mechanical source-level changes in client code.</p>
<p>When migrating from 1.3.x to 2.1.x you should first follow the instructions for
migrating <a class="reference internal" href="migration-guide-1.3.x-2.0.x.html#migration-2-0"><em>1.3.x to 2.0.x</em></a> and then <a class="reference internal" href="migration-guide-2.0.x-2.1.x.html#migration-2-1"><em>2.0.x to 2.1.x</em></a>.</p>
<div class="section" id="deprecated-closure-taking-props">
<h2>Deprecated Closure-Taking Props</h2>
<p><tt class="xref py py-class docutils literal"><span class="pre">Props</span></tt> instances used to contain a closure which produces an
<tt class="xref py py-class docutils literal"><span class="pre">Actor</span></tt> instance when invoked. This approach is flawed in that closures
are usually created in-line and thus carry a reference to their enclosing
object; this is not well known among programmers, in particular it can be
surprising that innocent-looking actor creation should not be serializable,
e.g. if the enclosing class is an actor. Another issue which came up often
during reviews is that these actor creators inadvertedly close over the Actor’s
<tt class="docutils literal"><span class="pre">this</span></tt> reference for calling methods on it, which is inherently unsafe.</p>
<p>Another reason for changing the underlying implementation is that Props now
carries information about which class of actor will be created, allowing the
extraction of mailbox type requirements (e.g. when using the Stash) before
trying to create the actor. Being based on the actor class and a list of
constructor arguments also allows these arguments to be serialized according to
the configured serializer bindings instead of mandating Java serialization
(which was used previously).</p>
<div class="section" id="what-changes-for-java">
<h3>What changes for Java?</h3>
<p>A new method <tt class="docutils literal"><span class="pre">Props.create</span></tt> has been introduced with two overloads:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="nc">Props</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="nc">MyActor</span><span class="o">.</span><span class="n">class</span><span class="o">,</span> <span class="n">arg1</span><span class="o">,</span> <span class="n">arg2</span><span class="o">,</span> <span class="o">...);</span>
<span class="c1">// or</span>
<span class="nc">Props</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyActorCreator</span><span class="o">(</span><span class="n">args</span> <span class="o">...));</span>
</pre></div>
</div>
<p>In the first case the existence of a constructor signature matching the
supplied arguments is verified at Props construction time. In the second case
it is verified that <tt class="docutils literal"><span class="pre">MyActorCreator</span></tt> (which must be a <tt class="docutils literal"><span class="pre">akka.japi.Creator&lt;?</span>
<span class="pre">extends</span> <span class="pre">Actor&gt;</span></tt>) is a static class. In both cases failure is signaled by
throwing a <tt class="xref py py-class docutils literal"><span class="pre">IllegalArgumentException</span></tt>.</p>
<p>The constructors of <tt class="xref py py-class docutils literal"><span class="pre">Props</span></tt> have been deprecated to facilitate migration.</p>
<p>The <tt class="xref py py-meth docutils literal"><span class="pre">withCreator</span></tt> methods have been deprecated. The functionality is
available by using <tt class="docutils literal"><span class="pre">Props.create(...).withDeploy(oldProps.deploy());</span></tt>.</p>
<p><tt class="xref py py-class docutils literal"><span class="pre">UntypedActorFactory</span></tt> has been deprecated in favor of the more precisely
typed <tt class="xref py py-class docutils literal"><span class="pre">Creator</span></tt>.</p>
</div>
<div class="section" id="what-changes-for-scala">
<h3>What changes for Scala?</h3>
<p>The case class signature of Props has been changed to only contain a
<tt class="xref py py-class docutils literal"><span class="pre">Deploy</span></tt>, a <tt class="xref py py-class docutils literal"><span class="pre">Class[_]</span></tt> and an immutable <tt class="xref py py-class docutils literal"><span class="pre">Seq[Any]</span></tt> (the
constructor arguments for the class). The old factory and extractor methods
have been deprecated.</p>
<p>Properly serializable <tt class="xref py py-class docutils literal"><span class="pre">Props</span></tt> can now be created for actors which take
constructor arguments by using <tt class="docutils literal"><span class="pre">Props(classOf[MyActor],</span> <span class="pre">arg1,</span> <span class="pre">arg2,</span> <span class="pre">...)</span></tt>.
In a future update—possibly within the 2.2.x timeframe—we plan to introduce a
macro which will transform the by-name argument to <tt class="docutils literal"><span class="pre">Props(new</span> <span class="pre">MyActor(...))</span></tt>
into a call to the former.</p>
<p>The <tt class="xref py py-meth docutils literal"><span class="pre">withCreator</span></tt> methods have been deprecated. The functionality is
available by using <tt class="docutils literal"><span class="pre">Props(...).withDeploy(oldProps.deploy)</span></tt>.</p>
</div>
</div>
<div class="section" id="immutable-everywhere">
<h2>Immutable everywhere</h2>
<p>Akka has in 2.2 been refactored to require <tt class="docutils literal"><span class="pre">scala.collection.immutable</span></tt> data structures as much as possible,
this leads to fewer bugs and more opportunity for sharing data safely.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Search</th>
<th class="head">Replace with</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">akka.japi.Util.arrayToSeq</span></tt></td>
<td><tt class="docutils literal"><span class="pre">akka.japi.Util.immutableSeq</span></tt></td>
</tr>
</tbody>
</table>
<p>If you need to convert from Java to <tt class="docutils literal"><span class="pre">scala.collection.immutable.Seq</span></tt> or <tt class="docutils literal"><span class="pre">scala.collection.immutable.Iterable</span></tt> you should use <tt class="docutils literal"><span class="pre">akka.japi.Util.immutableSeq(…)</span></tt>,
and if you need to convert from Scala you can simply switch to using immutable collections yourself or use the <tt class="docutils literal"><span class="pre">to[immutable.&lt;collection-type&gt;]</span></tt> method.</p>
</div>
<div class="section" id="actorcontext-actorreffactory-dispatcher">
<h2>ActorContext &amp; ActorRefFactory Dispatcher</h2>
<p>The return type of <tt class="docutils literal"><span class="pre">ActorContext</span></tt>'s and <tt class="docutils literal"><span class="pre">ActorRefFactory</span></tt>'s <tt class="docutils literal"><span class="pre">dispatcher</span></tt>-method now returns <tt class="docutils literal"><span class="pre">ExecutionContext</span></tt> instead of <tt class="docutils literal"><span class="pre">MessageDispatcher</span></tt>.</p>
</div>
<div class="section" id="removed-fallback-to-default-dispatcher">
<h2>Removed Fallback to Default Dispatcher</h2>
<p>If deploying an actor with a specific dispatcher, e.g.
<tt class="docutils literal"><span class="pre">Props(...).withDispatcher(&quot;d&quot;)</span></tt>, then it would previously fall back to
<tt class="docutils literal"><span class="pre">akka.actor.default-dispatcher</span></tt> if no configuration section for <tt class="docutils literal"><span class="pre">d</span></tt> could
be found.</p>
<p>This was beneficial for preparing later deployment choices during development
by grouping actors on dispatcher IDs but not immediately configuring those.
Akka 2.2 introduces the possibility to add dispatcher configuration to the
<tt class="docutils literal"><span class="pre">akka.actor.deployment</span></tt> section, making this unnecessary.</p>
<p>The fallback was removed because in many cases its application was neither
intended nor noticed.</p>
</div>
<div class="section" id="changed-configuration-section-for-dispatcher-mailbox">
<h2>Changed Configuration Section for Dispatcher &amp; Mailbox</h2>
<p>The mailbox configuration defaults moved from <tt class="docutils literal"><span class="pre">akka.actor.default-dispatcher</span></tt>
to <tt class="docutils literal"><span class="pre">akka.actor.default-mailbox</span></tt>. You will not have to change anything unless
your configuration overrides a setting in the default dispatcher section.</p>
<p>The <tt class="docutils literal"><span class="pre">mailbox-type</span></tt> now requires a fully-qualified class name for the mailbox
to use. The special words <tt class="docutils literal"><span class="pre">bounded</span></tt> and <tt class="docutils literal"><span class="pre">unbounded</span></tt> are retained for a
migration period throughout the 2.2 series.</p>
</div>
<div class="section" id="api-changes-to-fsm-and-testfsmref">
<h2>API changes to FSM and TestFSMRef</h2>
<p>The <tt class="docutils literal"><span class="pre">timerActive_?</span></tt> method has been deprecated in both the <tt class="docutils literal"><span class="pre">FSM</span></tt> trait and the <tt class="docutils literal"><span class="pre">TestFSMRef</span></tt>
class. You should now use the <tt class="docutils literal"><span class="pre">isTimerActive</span></tt> method instead. The old method will remain
throughout 2.2.x. It will be removed in Akka 2.3.</p>
</div>
<div class="section" id="threadpoolconfigbuilder">
<h2>ThreadPoolConfigBuilder</h2>
<p><tt class="docutils literal"><span class="pre">akka.dispatch.ThreadPoolConfigBuilder</span></tt> companion object has been removed,
and with it the <tt class="docutils literal"><span class="pre">conf_?</span></tt> method that was essentially only a type-inferencer aid for creation
of optional transformations on <tt class="docutils literal"><span class="pre">ThreadPoolConfigBuilder</span></tt>.
Instead use: <tt class="docutils literal"><span class="pre">option.map(o</span> <span class="pre">=&gt;</span> <span class="pre">(t:</span> <span class="pre">ThreadPoolConfigBuilder)</span> <span class="pre">=&gt;</span> <span class="pre">t.op(o))</span></tt>.</p>
</div>
<div class="section" id="scheduler">
<h2>Scheduler</h2>
<p>Akka's <tt class="docutils literal"><span class="pre">Scheduler</span></tt> has been augmented to also include a <tt class="docutils literal"><span class="pre">sender</span></tt> when scheduling to send messages, this should work Out-Of-The-Box for Scala users,
but for Java Users you will need to manually provide the <tt class="docutils literal"><span class="pre">sender</span></tt> – as usual use <tt class="docutils literal"><span class="pre">null</span></tt> to designate &quot;no sender&quot; which will behave just as before the change.</p>
</div>
<div class="section" id="zeromq-bytestring">
<h2>ZeroMQ ByteString</h2>
<p><tt class="docutils literal"><span class="pre">akka.zeromq.Frame</span></tt> and the use of <tt class="docutils literal"><span class="pre">Seq[Byte]</span></tt> in the API has been removed and is replaced by <tt class="docutils literal"><span class="pre">akka.util.ByteString</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">ZMQMessage.firstFrameAsString</span></tt> has been removed, please use <tt class="docutils literal"><span class="pre">ZMQMessage.frames</span></tt> or <tt class="docutils literal"><span class="pre">ZMQMessage.frame(int)</span></tt> to access the frames.</p>
</div>
<div class="section" id="brand-new-agents">
<h2>Brand new Agents</h2>
<p>Akka's <tt class="docutils literal"><span class="pre">Agent</span></tt> has been rewritten to improve the API and to remove the need to manually <tt class="docutils literal"><span class="pre">close</span></tt> an Agent.
It's also now an abstract class with the potential for subtyping and has a new factory method
allowing Java to correctly infer the type of the Agent.
The Java API has also been harmonized so both Java and Scala call the same methods.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old Java API</th>
<th class="head">New Java API</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">new</span> <span class="pre">Agent&lt;type&gt;(value,</span> <span class="pre">actorSystem)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">Agent.create(value,</span> <span class="pre">executionContext)</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">agent.update(newValue)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.send(newValue)</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">agent.future(Timeout)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.future()</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">agent.await(Timeout)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">Await.result(agent.future(),</span> <span class="pre">Timeout)</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">agent.send(Function)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.send(Mapper)</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">agent.sendOff(Function,</span> <span class="pre">ExecutionContext)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.sendOff(Mapper,</span> <span class="pre">ExecutionContext)</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">agent.alter(Function,</span> <span class="pre">Timeout)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.alter(Mapper)</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">agent.alterOff(Function,</span> <span class="pre">Timeout,</span> <span class="pre">ExecutionContext)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.alter(Mapper,</span> <span class="pre">ExecutionContext)</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">agent.map(Function)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.map(Mapper)</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">agent.flatMap(Function)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.flatMap(Mapper)</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">agent.foreach(Procedure)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.foreach(Foreach)</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">agent.suspend()</span></tt></td>
<td><tt class="docutils literal"><span class="pre">No</span> <span class="pre">replacement,</span> <span class="pre">pointless</span> <span class="pre">feature</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">agent.resume()</span></tt></td>
<td><tt class="docutils literal"><span class="pre">No</span> <span class="pre">replacement,</span> <span class="pre">pointless</span> <span class="pre">feature</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">agent.close()</span></tt></td>
<td><tt class="docutils literal"><span class="pre">No</span> <span class="pre">replacement,</span> <span class="pre">not</span> <span class="pre">needed</span> <span class="pre">in</span> <span class="pre">new</span> <span class="pre">implementation</span></tt></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old Scala API</th>
<th class="head">New Scala API</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Agent[T](value)(implicit</span> <span class="pre">ActorSystem)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">Agent[T](value)(implicit</span> <span class="pre">ExecutionContext)</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">agent.update(newValue)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.send(newValue)</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">agent.alterOff(Function1)(Timeout,</span> <span class="pre">ExecutionContext)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.alterOff(Function1)(ExecutionContext)</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">agent.await(Timeout)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">Await.result(agent.future,</span> <span class="pre">Timeout)</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">agent.future(Timeout)</span></tt></td>
<td><tt class="docutils literal"><span class="pre">agent.future</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">agent.suspend()</span></tt></td>
<td><tt class="docutils literal"><span class="pre">No</span> <span class="pre">replacement,</span> <span class="pre">pointless</span> <span class="pre">feature</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">agent.resume()</span></tt></td>
<td><tt class="docutils literal"><span class="pre">No</span> <span class="pre">replacement,</span> <span class="pre">pointless</span> <span class="pre">feature</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">agent.close()</span></tt></td>
<td><tt class="docutils literal"><span class="pre">No</span> <span class="pre">replacement,</span> <span class="pre">not</span> <span class="pre">needed</span> <span class="pre">in</span> <span class="pre">new</span> <span class="pre">implementation</span></tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="event-handlers-renamed-to-loggers">
<h2><tt class="docutils literal"><span class="pre">event-handlers</span></tt> renamed to <tt class="docutils literal"><span class="pre">loggers</span></tt></h2>
<p>If you have defined custom event handlers (loggers) in your configuration you need to change
<tt class="docutils literal"><span class="pre">akka.event-handlers</span></tt> to <tt class="docutils literal"><span class="pre">akka.loggers</span></tt> and
<tt class="docutils literal"><span class="pre">akka.event-handler-startup-timeout</span></tt> to <tt class="docutils literal"><span class="pre">akka.logger-startup-timeout</span></tt>.</p>
<p>The SLF4J logger has been renamed from <tt class="docutils literal"><span class="pre">akka.event.slf4j.Slf4jEventHandler</span></tt> to
<tt class="docutils literal"><span class="pre">akka.event.slf4j.Slf4jLogger</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">java.util.logging</span></tt> logger has been renamed from <tt class="docutils literal"><span class="pre">akka.contrib.jul.JavaLoggingEventHandler</span></tt> to
<tt class="docutils literal"><span class="pre">akka.contrib.jul.JavaLogger</span></tt>.</p>
</div>
<div class="section" id="remoting">
<h2>Remoting</h2>
<p>The remoting subsystem of Akka has been replaced in favor of a more flexible, pluggable driver based implementation. This
has required some changes to the configuration sections of <tt class="docutils literal"><span class="pre">akka.remote</span></tt>, the format of Akka remote addresses
and the Akka protocol itself.</p>
<p>The internal communication protocol of Akka has been evolved into a completely standalone entity, not tied to any
particular transport. This change has the effect that Akka 2.2 remoting is no longer able to directly communicate with
older versions.</p>
<p>The <tt class="docutils literal"><span class="pre">akka.remote.transport</span></tt> configuration key has been removed as the remoting system itself is no longer replaceable.
Custom transports are now pluggable via the <tt class="docutils literal"><span class="pre">akka.remote.enabled-transpotrs</span></tt> key (see the <tt class="xref py py-meth docutils literal"><span class="pre">akka.remote.Transport</span></tt> SPI
and the documentation of remoting for more detail on drivers). The transport loaded by default is a Netty based TCP
driver similar in functionality to the default remoting in Akka 2.1.</p>
<p>Transports are now fully pluggable through drivers, therefore transport specific settings like listening ports now live in the namespace
of their driver configuration. In particular TCP related settings are now under <tt class="docutils literal"><span class="pre">akka.remote.netty.tcp</span></tt>.</p>
<p>As a result of being able to replace the transport protocol, it is now necessary to include the protocol information
in Akka URLs for remote addresses. Therefore a remote address of <tt class="docutils literal"><span class="pre">akka://remote-sys&#64;remotehost:2552/user/actor</span></tt>
has to be changed to <tt class="docutils literal"><span class="pre">akka.tcp://remote-sys&#64;remotehost:2552/user/actor</span></tt> if the remote system uses TCP as transport. If
the other system uses SSL on top of TCP, the correct address would be <tt class="docutils literal"><span class="pre">akka.ssl.tcp://remote-sys&#64;remotehost:2552/user/actor</span></tt>.</p>
<p>Remote lifecycle events have been changed to a more coarse-grained, simplified model. All remoting events are subclasses
of <tt class="xref py py-meth docutils literal"><span class="pre">akka.remote.RemotingLifecycle</span></tt>. Events related to the lifecycle of <em>associations</em> (formerly called <em>connections</em>)
be it inbound or outbound are subclasses of <tt class="xref py py-meth docutils literal"><span class="pre">akka.remote.AssociationEvent</span></tt> (which is in turn a subclass of
<tt class="xref py py-meth docutils literal"><span class="pre">RemotingLifecycle</span></tt>). The direction of the association (inbound or outbound) triggering an <tt class="docutils literal"><span class="pre">AssociationEvent</span></tt> is
available via the <tt class="docutils literal"><span class="pre">inbound</span></tt> boolean field of the event.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The change in terminology from &quot;Connection&quot; to &quot;Association&quot; reflects the fact that the remoting subsystem may use
connectionless transports, but an association similar to transport layer connections is maintained between endpoints
by the Akka protocol.</p>
</div>
<p>New configuration settings are also available, see the remoting documentation for more detail: <a class="reference internal" href="../scala/remoting.html#remoting-scala"><em>Remoting</em></a></p>
</div>
<div class="section" id="use-actorselection-instead-of-actorfor">
<span id="migration-2-2-actorselection"></span><h2>Use <tt class="docutils literal"><span class="pre">actorSelection</span></tt> instead of <tt class="docutils literal"><span class="pre">actorFor</span></tt></h2>
<p><tt class="docutils literal"><span class="pre">actorFor</span></tt> is deprecated in favor of <tt class="docutils literal"><span class="pre">actorSelection</span></tt> because actor references
acquired with <tt class="docutils literal"><span class="pre">actorFor</span></tt> behave differently for local and remote actors.
In the case of a local actor reference, the named actor needs to exist before the
lookup, or else the acquired reference will be an <tt class="xref py py-class docutils literal"><span class="pre">EmptyLocalActorRef</span></tt>.
This will be true even if an actor with that exact path is created after acquiring
the actor reference. For remote actor references acquired with <cite>actorFor</cite> the
behaviour is different and sending messages to such a reference will under the hood
look up the actor by path on the remote system for every message send.</p>
<p>Messages can be sent via the <tt class="xref py py-class docutils literal"><span class="pre">ActorSelection</span></tt> and the path of the
<tt class="xref py py-class docutils literal"><span class="pre">ActorSelection</span></tt> is looked up when delivering each message. If the selection
does not match any actors the message will be dropped.</p>
<p>To acquire an <tt class="xref py py-class docutils literal"><span class="pre">ActorRef</span></tt> for an <tt class="xref py py-class docutils literal"><span class="pre">ActorSelection</span></tt> you need to
send a message to the selection and use the <tt class="docutils literal"><span class="pre">sender</span></tt> reference of the reply from
the actor. There is a built-in <tt class="docutils literal"><span class="pre">Identify</span></tt> message that all Actors will understand
and automatically reply to with a <tt class="docutils literal"><span class="pre">ActorIdentity</span></tt> message containing the
<tt class="xref py py-class docutils literal"><span class="pre">ActorRef</span></tt>.</p>
<p>You can also acquire an <tt class="xref py py-class docutils literal"><span class="pre">ActorRef</span></tt> for an <tt class="xref py py-class docutils literal"><span class="pre">ActorSelection</span></tt> with
the <tt class="docutils literal"><span class="pre">resolveOne</span></tt> method of the <tt class="xref py py-class docutils literal"><span class="pre">ActorSelection</span></tt>. It returns a <tt class="docutils literal"><span class="pre">Future</span></tt>
of the matching <tt class="xref py py-class docutils literal"><span class="pre">ActorRef</span></tt> if such an actor exists. It is completed with
failure [[akka.actor.ActorNotFound]] if no such actor exists or the identification
didn't complete within the supplied <cite>timeout</cite>.</p>
<p>Read more about <tt class="docutils literal"><span class="pre">actorSelection</span></tt> in <a class="reference internal" href="../java/untyped-actors.html#actorselection-java"><em>docs for Java</em></a> or
<a class="reference internal" href="../scala/actors.html#actorselection-scala"><em>docs for Scala</em></a>.</p>
</div>
<div class="section" id="actorref-equality-and-sending-to-remote-actors">
<h2>ActorRef equality and sending to remote actors</h2>
<p>Sending messages to an <tt class="docutils literal"><span class="pre">ActorRef</span></tt> must have the same semantics no matter if the target actor is located
on a remote host or in the same <tt class="docutils literal"><span class="pre">ActorSystem</span></tt> in the same JVM. This was not always the case. For example
when the target actor is terminated and created again under the same path. Sending to local references
of the previous incarnation of the actor will not be delivered to the new incarnation, but that was the case
for remote references. The reason was that the target actor was looked up by its path on every message
delivery and the path didn't distinguish between the two incarnations of the actor. This has been fixed, and
messages sent to a remote reference that points to a terminated actor will not be delivered to a new
actor with the same path.</p>
<p>Equality of <tt class="docutils literal"><span class="pre">ActorRef</span></tt> has been changed to match the intention that an <tt class="docutils literal"><span class="pre">ActorRef</span></tt> corresponds to the target
actor instance. Two actor references are compared equal when they have the same path and point to the same
actor incarnation. A reference pointing to a terminated actor does not compare equal to a reference pointing
to another (re-created) actor with the same path. Note that a restart of an actor caused by a failure still
means that it's the same actor incarnation, i.e. a restart is not visible for the consumer of the <tt class="docutils literal"><span class="pre">ActorRef</span></tt>.</p>
<p>Equality in 2.1 was only based on the path of the <tt class="docutils literal"><span class="pre">ActorRef</span></tt>. If you need to keep track of actor references
in a collection and do not care about the exact actor incarnation you can use the <tt class="docutils literal"><span class="pre">ActorPath</span></tt> as key, because
the identifier of the target actor is not taken into account when comparing actor paths.</p>
<p>Remote actor references acquired with <tt class="docutils literal"><span class="pre">actorFor</span></tt> do not include the full information about the underlying actor
identity and therefore such references do not compare equal to references acquired with <tt class="docutils literal"><span class="pre">actorOf</span></tt>,
<tt class="docutils literal"><span class="pre">sender</span></tt>, or <tt class="docutils literal"><span class="pre">context.self</span></tt>. Because of this <tt class="docutils literal"><span class="pre">actorFor</span></tt> is deprecated, as explained in
<a class="reference internal" href="migration-guide-2.1.x-2.2.x.html#migration-2-2-actorselection"><em>Use actorSelection instead of actorFor</em></a>.</p>
<p>Note that when a parent actor is restarted its children are by default stopped and re-created, i.e. the child
after the restart will be a different incarnation than the child before the restart. This has always been the
case, but in some situations you might not have noticed, e.g. when comparing such actor references or sending
messages to remote deployed children of a restarted parent.</p>
<p>This may also have implications if you compare the <tt class="docutils literal"><span class="pre">ActorRef</span></tt> received in a <tt class="docutils literal"><span class="pre">Terminated</span></tt> message
with an expected <tt class="docutils literal"><span class="pre">ActorRef</span></tt>.</p>
<p>The following will not match:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">ref</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">actorFor</span><span class="o">(</span><span class="s">&quot;akka.tcp://actorSystemName@10.0.0.1:2552/user/actorName&quot;</span><span class="o">)</span>

<span class="k">def</span> <span class="n">receive</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Terminated</span><span class="o">(</span><span class="n">`ref`</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Instead, use actorSelection followed by identify request, and watch the verified actor reference:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">selection</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">actorSelection</span><span class="o">(</span>
  <span class="s">&quot;akka.tcp://actorSystemName@10.0.0.1:2552/user/actorName&quot;</span><span class="o">)</span>
<span class="n">selection</span> <span class="o">!</span> <span class="nc">Identify</span><span class="o">(</span><span class="nc">None</span><span class="o">)</span>
<span class="k">var</span> <span class="n">ref</span><span class="k">:</span> <span class="kt">ActorRef</span> <span class="o">=</span> <span class="k">_</span>

<span class="k">def</span> <span class="n">receive</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">ActorIdentity</span><span class="o">(</span><span class="n">_</span><span class="o">,</span> <span class="nc">Some</span><span class="o">(</span><span class="n">actorRef</span><span class="o">))</span> <span class="k">=&gt;</span>
    <span class="n">ref</span> <span class="k">=</span> <span class="n">actorRef</span>
    <span class="n">context</span> <span class="n">watch</span> <span class="n">ref</span>
  <span class="k">case</span> <span class="nc">ActorIdentity</span><span class="o">(</span><span class="n">_</span><span class="o">,</span> <span class="nc">None</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="c1">// not alive</span>
  <span class="k">case</span> <span class="nc">Terminated</span><span class="o">(</span><span class="n">r</span><span class="o">)</span> <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="n">ref</span> <span class="k">=&gt;</span> <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="use-watch-instead-of-isterminated">
<h2>Use <tt class="docutils literal"><span class="pre">watch</span></tt> instead of <tt class="docutils literal"><span class="pre">isTerminated</span></tt></h2>
<p><tt class="docutils literal"><span class="pre">ActorRef.isTerminated</span></tt> is deprecated in favor of <tt class="docutils literal"><span class="pre">ActorContext.watch</span></tt> because
<tt class="docutils literal"><span class="pre">isTerminated</span></tt> behaves differently for local and remote actors.</p>
</div>
<div class="section" id="deathwatch-semantics-are-simplified">
<h2>DeathWatch Semantics are Simplified</h2>
<div class="section" id="deathpactexception-is-now-fatal">
<h3>DeathPactException is now Fatal</h3>
<p>Previously an unhandled <tt class="xref py py-class docutils literal"><span class="pre">Terminated</span></tt> message which led to a
<tt class="xref py py-class docutils literal"><span class="pre">DeathPactException</span></tt> to the thrown would be answered with a <tt class="docutils literal"><span class="pre">Restart</span></tt>
directive by the default supervisor strategy. This is not intuitive given the
name of the exception and the Erlang linking feature by which it was inspired.
The default strategy has thus be changed to return <tt class="docutils literal"><span class="pre">Stop</span></tt> in this case.</p>
<p>It can be argued that previously the actor would likely run into a restart loop
because watching a terminated actor would lead to a <tt class="xref py py-class docutils literal"><span class="pre">DeathPactException</span></tt>
immediately again.</p>
</div>
<div class="section" id="unwatching-now-prevents-reception-of-terminated">
<h3>Unwatching now Prevents Reception of Terminated</h3>
<p>Previously calling <tt class="xref py py-meth docutils literal"><span class="pre">ActorContext.unwatch</span></tt> would unregister lifecycle
monitoring interest, but if the target actor had terminated already the
<tt class="xref py py-class docutils literal"><span class="pre">Terminated</span></tt> message had already been enqueued and would be received
later—possibly leading to a <tt class="xref py py-class docutils literal"><span class="pre">DeathPactException</span></tt>. This behavior has been
modified such that the <tt class="xref py py-class docutils literal"><span class="pre">Terminated</span></tt> message will be silently discarded
if <tt class="xref py py-meth docutils literal"><span class="pre">unwatch</span></tt> is called before processing the <tt class="xref py py-class docutils literal"><span class="pre">Terminated</span></tt>
message. Therefore the following is now safe:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">context</span><span class="o">.</span><span class="n">stop</span><span class="o">(</span><span class="n">target</span><span class="o">)</span>
<span class="n">context</span><span class="o">.</span><span class="n">unwatch</span><span class="o">(</span><span class="n">target</span><span class="o">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dispatcher-and-mailbox-implementation-changes">
<h2>Dispatcher and Mailbox Implementation Changes</h2>
<p>This point is only relevant if you have implemented a custom mailbox or
dispatcher and want to migrate that to Akka 2.2. The constructor signature of
<tt class="xref py py-class docutils literal"><span class="pre">MessageDispatcher</span></tt> has changed, it now takes a
<tt class="xref py py-class docutils literal"><span class="pre">MessageDispatcherConfigurator</span></tt> instead of
<tt class="xref py py-class docutils literal"><span class="pre">DispatcherPrerequisites</span></tt>. Its <tt class="xref py py-class docutils literal"><span class="pre">createMailbox</span></tt> method now
receives one more argument of type <tt class="xref py py-class docutils literal"><span class="pre">MailboxType</span></tt>, which is the mailbox
type determined by the <tt class="xref py py-class docutils literal"><span class="pre">ActorRefProvider</span></tt> for the actor based on its
deployment. The <tt class="xref py py-class docutils literal"><span class="pre">DispatcherPrerequisites</span></tt> now include a
<tt class="xref py py-class docutils literal"><span class="pre">Mailboxes</span></tt> instance which can be used for resolving mailbox references.
The constructor signatures of the built-in dispatcher implementation have been
adapted accordingly.  The traits describing mailbox semantics have been
separated from the implementation traits.</p>
</div>
</div>


          </div>
          <div class="span3"><p class="contents-title">Contents</p>
              <div id="scroller-anchor">
                <div id="scroller">
                  <div id="toc"></div>
                </div>
              </div></div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
  <div class="container">
    <ul>
      <li><h5>Akka</h5></li>
      <li><a href="http://akka.io/docs">Documentation</a></li>
      <li><a href="http://akka.io/faq">FAQ</a></li>
      <li><a href="http://typesafe.com/stack/downloads/akka">Downloads</a></li>
      <li><a href="http://akka.io/news">News</a></li>
      <li><a href="http://letitcrash.com">Blog</a></li>
    </ul>
    <ul>
      <li><h5>Contribute</h5></li>
      <li><a href="http://akka.io/community">Community Projects</a></li>
      <li><a href="http://github.com/akka/akka">Source Code</a></li>
      <li><a href="http://groups.google.com/group/akka-user">Mailing List</a></li>      
      <li><a href="http://doc.akka.io/docs/akka/current/project/issue-tracking.html">Report a Bug</a></li>      
    </ul>
    <ul>
      <li><h5>Company</h5></li>
      <li><a href="http://typesafe.com/products/typesafe-subscription">Commercial Support</a></li>
      <li><a href="http://akka.io/team">Team</a></li>
      <li><a href="mailto:info@typesafe.com">Contact</a></li>
    </ul>
    <ul>
      <li><img src="../_static/watermark.png" align="center"/></li>
    </ul>
  </div>
  <div class="container copyright">
    <p style="float: left;">
      © 2013 <a href="http://typesafe.com/">Typesafe Inc.</a> <span class="license">Akka is Open Source and available under the Apache 2 License.</span>
    </p>
    <p style="float: right; font-size: 12px;">
      Last updated: Oct 23, 2013
    </p>          
  </div>
</div>
<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script type="text/javascript">
    google.load('search', '1', {language : 'en', style : google.loader.themes.MINIMALIST});
    google.setOnLoadCallback(function() {
    var customSearchOptions = {};  var customSearchControl = new google.search.CustomSearchControl(
    '003065520604945464838:izzukx8-qba', customSearchOptions);
    customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
    customSearchControl.draw('cse');
    var path = window.location.pathname.split('/').slice(0,4);
    if(window.location.hostname && path.length >= 4) {
    var site = "site:" + window.location.hostname + path.join('/').toString();
    customSearchControl.setSearchStartingCallback(this, function(c, s, q) { s.setQueryAddition(site); });
    }
    }, true);
</script>
<style type="text/css">
    .gsc-control-cse {
    font-family: Arial, sans-serif;
    border-color: rgb(242, 242, 235);
    background-color: rgb(242, 242, 235);
    }
    .gsc-control-cse .gsc-table-result {
      font-family: Arial, sans-serif;
      display: block;
    }
    input.gsc-input {
    border-color: #BBBBBB;
    }
    input.gsc-search-button {
    border-color: rgb(34, 57, 64);
    background-color: rgb(68, 114, 129);
    color: #FFFFFF;
    }
    .gsc-tabHeader.gsc-tabhInactive {
    border-color: #777777;
    background-color: #777777;
    }
    .gsc-tabHeader.gsc-tabhActive {
    border-color: #333333;
    background-color: #333333;
    }
    .gsc-tabsArea {
    border-color: #333333;
    }
    .gsc-webResult.gsc-result,
    .gsc-results .gsc-imageResult {
      border-color: #666666;
      background-color: #FFFFFF;
      padding: 0.5em 0.5em;
    }
    .gsc-webResult.gsc-result:hover,
    .gsc-imageResult:hover {
      border-color: #AAAAAA;
      background-color: #FFFFFF;
      padding: 0.5em 0.5em;
    }
    .gsc-webResult.gsc-result.gsc-promotion:hover {
    border-color: #AAAAAA;
    background-color: #FFFFFF;
    }
    .gs-webResult.gs-result a.gs-title:link,
    .gs-webResult.gs-result a.gs-title:link b,
    .gs-imageResult a.gs-title:link,
    .gs-imageResult a.gs-title:link b {
    color: #444444;
    }
    .gs-webResult.gs-result a.gs-title:visited,
    .gs-webResult.gs-result a.gs-title:visited b,
    .gs-imageResult a.gs-title:visited,
    .gs-imageResult a.gs-title:visited b {
    color: #444444;
    }
    .gs-webResult.gs-result a.gs-title:hover,
    .gs-webResult.gs-result a.gs-title:hover b,
    .gs-imageResult a.gs-title:hover,
    .gs-imageResult a.gs-title:hover b {
    color: #444444;
    }
    .gs-webResult.gs-result a.gs-title:active,
    .gs-webResult.gs-result a.gs-title:active b,
    .gs-imageResult a.gs-title:active,
    .gs-imageResult a.gs-title:active b {
    color: #777777;
    }
    .gsc-cursor-page {
    color: #444444;
    }
    a.gsc-trailing-more-results:link {
    color: #444444;
    }
    .gs-webResult .gs-snippet,
    .gs-imageResult .gs-snippet,
    .gs-fileFormatType {
    color: #333333;
    }
    .gs-webResult div.gs-visibleUrl,
    .gs-imageResult div.gs-visibleUrl {
    color: #000000;
    }
    .gs-webResult div.gs-visibleUrl-short {
    color: #000000;
    }
    .gs-webResult div.gs-visibleUrl-short {
    display: none;
    }
    .gs-webResult div.gs-visibleUrl-long {
    display: block;
    }
    .gs-promotion div.gs-visibleUrl-short {
    display: none;
    }
    .gs-promotion div.gs-visibleUrl-long {
    display: block;
    }
    .gsc-cursor-box {
    border-color: #FFFFFF;
    }
    .gsc-results .gsc-cursor-box .gsc-cursor-page {
    border-color: #777777;
    background-color: #FFFFFF;
    color: #444444;
    }
    .gsc-results .gsc-cursor-box .gsc-cursor-current-page {
    border-color: #333333;
    background-color: #333333;
    color: #444444;
    }
    .gsc-webResult.gsc-result.gsc-promotion {
    border-color: #CCCCCC;
    background-color: #E6E6E6;
    }
    .gsc-completion-title {
    color: #444444;
    }
    .gsc-completion-snippet {
    color: #333333;
    }
    .gs-promotion a.gs-title:link,
    .gs-promotion a.gs-title:link *,
    .gs-promotion .gs-snippet a:link {
    color: #0000CC;
    }
    .gs-promotion a.gs-title:visited,
    .gs-promotion a.gs-title:visited *,
    .gs-promotion .gs-snippet a:visited {
    color: #0000CC;
    }
    .gs-promotion a.gs-title:hover,
    .gs-promotion a.gs-title:hover *,
    .gs-promotion .gs-snippet a:hover {
    color: #444444;
    }
    .gs-promotion a.gs-title:active,
    .gs-promotion a.gs-title:active *,
    .gs-promotion .gs-snippet a:active {
    color: #00CC00;
    }
    .gs-promotion .gs-snippet,
    .gs-promotion .gs-title .gs-promotion-title-right,
    .gs-promotion .gs-title .gs-promotion-title-right *  {
    color: #333333;
    }
    .gs-promotion .gs-visibleUrl,
    .gs-promotion .gs-visibleUrl-short {
    color: #00CC00;
    }
</style>
<script type="text/javascript">
  $('#toc').toc();
</script>
  

  </body>
</html>